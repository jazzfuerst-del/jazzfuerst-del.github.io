<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chasse au tr√©sor</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --bg:#0b1020; --fg:#eef1f7; --muted:#9aa3b2; --card:#121a33;
      --accent:#7c5cff; --ok:#22c55e; --err:#ef4444; --ring:rgba(124,92,255,.3);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f7fb; --fg:#141824; --muted:#606b80; --card:#ffffff; --ring:rgba(124,92,255,.2); }
      body{ background:linear-gradient(180deg,#fbfbff,#eef1ff 25%,#f6f7fb); }
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
      color:var(--fg);
      min-height:100svh;
      display:grid;
      place-items:center;
      padding:24px;
      background:
        radial-gradient(80vw 80vw at 10% 10%, rgba(124,92,255,.08), transparent 40%),
        radial-gradient(70vw 70vw at 90% 0%, rgba(34,197,94,.09), transparent 45%),
        radial-gradient(70vw 70vw at 50% 100%, rgba(59,130,246,.08), transparent 45%),
        var(--bg);
    }
    .shell{width:min(820px,100%)}
    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-radius:20px;
      box-shadow:0 10px 30px rgba(2,6,23,.25);
      padding:28px;
      position:relative;
      overflow:hidden;
      text-align:left;
    }

    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(124,92,255,.12);color:#6b5cff;font-weight:600;font-size:.85rem}
    h1{font-size:clamp(1.4rem,1.1rem+2vw,2.2rem);margin:12px 0 4px;letter-spacing:.3px}
    .subtitle{color:var(--muted);margin:0 0 16px;font-size:1rem;line-height:1.4}

    .riddle{font-size:1.125rem;line-height:1.6;margin:16px 0 18px;white-space: pre-line}

    .inputRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    input[type=text]{
      flex:1;min-width:200px;padding:14px 14px;border-radius:12px;
      border:1px solid rgba(124,92,255,.25);outline:0;font-size:1rem;
      background:transparent;color:var(--fg);
    }
    input[type=text]:focus{box-shadow:0 0 0 6px var(--ring)}
    button.btn{
      padding:12px 16px;border-radius:12px;border:0;font-weight:600;cursor:pointer;
      background:linear-gradient(180deg,var(--accent),#5c3bff);color:white;
      box-shadow:0 6px 16px rgba(92,59,255,.45)
    }
    button.linkLike{background:transparent;color:var(--accent);box-shadow:none;border:0;padding:6px 8px;font-weight:600;cursor:pointer}

    .rowBetween{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;align-items:center;justify-content:space-between;color:var(--muted);font-size:.95rem}
    .rowRight{width:100%;margin-top:10px;text-align:right;font-size:.95rem;color:var(--muted);}

    .msg{margin-top:14px;font-weight:600}
    .msg.ok{color:var(--ok)}
    .msg.err{color:var(--err)}

    .section{display:none}
    .section.active{display:block}

    .bigText{line-height:1.6;color:var(--fg);background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;text-align:left}
    .plainText{font-size:1.05rem;line-height:1.6;color:var(--fg);text-align:left}

    .mediaImg{width:100%;border-radius:16px;margin:12px 0;box-shadow:0 8px 24px rgba(0,0,0,.4);border:1px solid rgba(255,255,255,.12);}
    .mediaAudio{width:100%;margin-top:12px;}

    .confetti{position:absolute;inset:0;pointer-events:none;}
    .confetti i{position:absolute;width:8px;height:14px;border-radius:2px;opacity:0;animation:pop 1.2s ease-out forwards}
    @keyframes pop{0%{transform:translate(var(--x,0),0) rotate(0);opacity:1}100%{transform:translate(var(--x,0),-160px) rotate(1turn);opacity:0}}
  </style>
</head>
<body>
  <div class="shell">
    <div class="card" id="card">
      <span class="pill" id="stepName">√âtape ?</span>
      <h1 id="screenTitle">‚Ä¶</h1>
      <p class="subtitle" id="screenSubtitle">‚Ä¶</p>

      <!-- √âcran 1 : √ânigme -->
      <section id="screen-riddle" class="section">
        <div id="riddleContent"></div>

        <div class="inputRow">
          <input id="answer" type="text" autocomplete="off" placeholder="Votre r√©ponse" />
          <button class="btn" id="submitAnswer">Valider</button>
        </div>

        <div class="rowBetween">
          <span id="attempts">0 tentative</span>
          <button class="linkLike" id="hintBtn">Besoin d'un indice ?</button>
        </div>

        <div class="msg" id="msg" aria-live="polite"></div>
      </section>

      <!-- √âcran 2 : Briefing -->
      <section id="screen-briefing" class="section">
        <div class="bigText" id="briefingText"></div>
        <button class="btn" style="margin-top:20px;width:100%" id="goToDestination">Voir la prochaine √©tape</button>
      </section>

      <!-- √âcran 3 : Destination -->
      <section id="screen-destination" class="section">
        <div id="destinationContent" class="plainText"></div>
        <div class="rowRight">
          <button class="linkLike" id="destHintBtn">Besoin d'un indice ?</button>
        </div>
        <div class="msg" id="destMsg" aria-live="polite"></div>
      </section>

      <div class="confetti" id="confetti" aria-hidden="true"></div>
    </div>
  </div>

  <script>
    // ‚úÖ Mets tes √©tapes ici (exemples inclus)
    const STEPS = {
      "1": {
        label: "Test",

        riddleTitle: "√ânigme Test",
        riddleQuestion: "Je parle sans bouche et j'entends sans oreilles. Je n'ai pas de corps, mais je prends vie avec le vent. Qui suis-je ?",
        // riddleImage: "images/mon-indice.jpg",
        // riddleAudio: "sons/indice.mp3",
        hint: "Pense au son qui revient quand tu cries dans une grotte.",
        answers: ["√©cho","echo", "l'echo","l'√©cho"],

        briefingTitle: "Code test",
        briefingText: "2",
        briefingColor: "#22c55e",
        briefingSize: "1.6rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "Rendez-vous sous l'arche en pierre pr√®s de la fontaine.",
        // destinationImage: "images/destination1.jpg",
        // destinationAudio: "sons/destination1.mp3",
        destHint: "Cherchez une arche en pierre."
      },

      "2": {
        label: "T√©l√©cabine du Pic Blanc",
        riddleTitle: "√ânigme",
        riddleImage: "Equation Alpe Huez.png",
        hint: "Les demi-crochets sont l'expression math√©matique de partie enti√®re.",
        answers: ["42"],

        briefingTitle: "Code",
        briefingText: "2",
        briefingColor: "#FFFF00",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "Autrefois, ils gardaient leurs moutons. Aujourd‚Äôhui, ils gardent les bons plans.",
        destHint: "Il est l'heure pour un peu de l√®che vitrine, empruntez les escaliers pour trouver le QR code."
      },
      
       "3": {
        label: "Centre commercial Les Bergers",
        riddleTitle: "√ânigme",
        riddleQuestion: "Pig Pen",
        hint: "D√©codez le codex dans la Gazette de l'Alpe d'Huez.",
        answers: ["Pas d'accident de travail pendant le s√©minaire","Pas d'accident de travail pendant le seminaire","pas d'accident de travail pendant le s√©minaire","pas d'accident de travail pendant le seminaire"],

        briefingTitle: "Code",
        briefingText: "7",
        briefingColor: "#0000FF",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationImage: "Main.png",
        destinationAudio: "Orgue.mp3",
        destHint: "Ni refuge ni chalet, pourtant on s‚Äôy recueille."
      },

      "4": {
        label: "Eglise Notre Dame des Neiges",
        riddleTitle: "√ânigme",
        riddleQuestion: "Je traverse la pierre sans la briser,\nJe caresse sans main et r√©chauffe sans feu.\nJe fais danser les couleurs sur les murs,\nEt disparais quand la nuit tombe.\nQui suis-je ?",
        hint: "Cherchez autour de vous‚Ä¶ Certains vitraux ne seraient rien sans moi.",
        answers: ["Lumi√®re","lumi√®re","Lumiere","lumiere"],

        briefingTitle: "Code",
        briefingText: "4",
        briefingColor: "#FF0000",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "Rendez-vous au point z√©ro des aventures.",
        destHint: "Avant de grimper, les alpinistes y font toujours une pause."
      },

      "5": {
        label: "Camp de Base",
        riddleTitle: "√ânigme",
        riddleImage: "Triangle + Rond.png",
        hint: "Compl√©tez les Sudokus dans la Gazette de l'Alpe d'Huez.",
        answers: ["14"],

        briefingTitle: "Code",
        briefingText: "1",
        briefingColor: "#008000",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "21 virages m√®nent jusqu‚Äô√† moi.",
        destHint: "Cherchez le lieu o√π les coureurs terminent leur ascension mythique."
      },

       "6": {
        label: "Arriv√©e du Tour de France",
        riddleTitle: "√ânigme",
        riddleQuestion: "Trouvez l'erreur :",
        riddleImage: "Drapeau.png",
        hint: "Quelle nationalit√© n'a jamais remport√© l'√©tape de l'Alpe d'Huez?",
        answers: ["Allemagne"],

        briefingTitle: "Code",
        briefingText: "9",
        briefingColor: "#FFA500",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "On y fabrique une gourmandise qui se roule sur un b√¢ton.", //"Les crampons sont de sortie, mais cette fois, ce n‚Äôest pas pour gravir une montagne.",
        destHint: "M√™me le dentiste aurait peur‚Ä¶ c‚Äôest un lieu tr√®s sucr√© !",
      },

      "7": {
        label: "Terrain de Foot",
        riddleTitle: "√ânigme",
        riddleQuestion: "Un si√®cle d'histoire et de transformations",
        hint: "Quelle phrase se cachent derri√®re les trous ?",
        answers: ["Les curieux se multiplient, les p√¢turages deviennent un environnement vivant","Les curieux se multiplient, les p√¢turages deviennent un environnement vivant.","les curieux se multiplient, les p√¢turages deviennent un environnement vivant","les curieux se multiplient, les p√¢turages deviennent un environnement vivant."],

        briefingTitle: "Code",
        briefingText: "6",
        briefingColor: "#FFFF00",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationImage: "Ski.png",
        destHint: "Cherchez le repaire de ceux qui enseignent l‚Äôart de glisser."
      },

      "8": {
        label: "Office du tourisme - ESF",
        riddleTitle: "√ânigme",
        riddleImage: "Equation Alpe Huez.png",
        hint: "Les demi-crochets sont l'expression math√©matique de partie enti√®re.",
        answers: ["42"],

        briefingTitle: "Code",
        briefingText: "3",
        briefingColor: "#0000FF",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "L‚Äôhiver je fume dans le froid, l‚Äô√©t√© je brille au soleil.",
        destHint: "Ici on ne skie pas : on flotte."
      },

       "9": {
        label: "Piscine Ext√©rieure",
        riddleTitle: "√ânigme",
        riddleQuestion: "Pig Pen",
        hint: "D√©codez le codex dans la Gazette de l'Alpe d'Huez.",
        answers: ["Pas d'accident de travail pendant le s√©minaire","Pas d'accident de travail pendant le seminaire","pas d'accident de travail pendant le s√©minaire","pas d'accident de travail pendant le seminaire"],

        briefingTitle: "Code",
        briefingText: "5",
        briefingColor: "#FF0000",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "Rendez-vous l√† ou l'eau a brill√©.",
        destHint: "Le point culture pourrait vous √™tre utile. En patois, son nom signifie ‚Äútorrent brillant‚Äù."
      },

       "10": {
        label: "Point du Rif Briant",
        riddleTitle: "√ânigme",
        riddleImage: "Rebu.png",
        hint: "Assemblez les sons, pas les images.",
        answers: ["Raclette","raclette"],

        briefingTitle: "Code",
        briefingText: "8",
        briefingColor: "#008000",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "Demeure royale qui n'abrite aucun tr√¥ne.",
        destHint: "Ici, le seul roi‚Ä¶ c‚Äôest le sport."
      },

      "11": {
        label: "Palais des sports",
        riddleTitle: "√ânigme",
        riddleImage: "Triangle + Rond.png",
        hint: "Compl√©tez les Sudokus dans la Gazette de l'Alpe d'Huez.",
        answers: ["14"],

        briefingTitle: "Code",
        briefingText: "4",
        briefingColor: "#FFA500",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "Cherchez le miroir glac√© du village.",
        destHint: "Un lieu de glace et d‚Äô√©quilibre."
      },

       "12": {
        label: "Patinoire ext√©rieure",
        riddleTitle: "√ânigme",
        riddleQuestion: "Un si√®cle d'histoire et de transformations",
        hint: "Quelle phrase se cachent derri√®re les trous ?",
        answers: ["Les curieux se multiplient, les p√¢turages deviennent un environnement vivant","Les curieux se multiplient, les p√¢turages deviennent un environnement vivant.","les curieux se multiplient, les p√¢turages deviennent un environnement vivant","les curieux se multiplient, les p√¢turages deviennent un environnement vivant."],

        briefingTitle: "Code",
        briefingText: "6",
        briefingColor: "#FFC0CB",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationText: "Suspendu au fil de la montagne, je marche sans pieds et je grimpe sans souffle.",
        destHint: "C‚Äôest lui qui relie la station au sommet le plus haut."
      },
       "13": {
        label: "Cabane √† sucre",
        riddleTitle: "√ânigme",
        riddleQuestion: "Un si√®cle d'histoire et de transformations",
        hint: "Quelle phrase se cachent derri√®re les trous ?",
        answers: ["Les curieux se multiplient, les p√¢turages deviennent un environnement vivant","Les curieux se multiplient, les p√¢turages deviennent un environnement vivant.","les curieux se multiplient, les p√¢turages deviennent un environnement vivant","les curieux se multiplient, les p√¢turages deviennent un environnement vivant."],

        briefingTitle: "Code",
        briefingText: "6",
        briefingColor: "#FFFF00",
        briefingSize: "4rem",

        destinationTitle: "Prochaine √©tape",
        destinationImage: "Ski.png",
        destHint: "Cherchez le repaire de ceux qui enseignent l‚Äôart de glisser."
      },
    };

    function normalize(s){
      return (s||"").toString().trim().toLowerCase()
        .normalize("NFD").replace(/\p{Diacritic}/gu,"")
        .replace(/[^a-z0-9'\s.-]/g,"").replace(/\s+/g," ");
    }

    function confetti(){
      const c=document.querySelector('#confetti');
      c.innerHTML='';
      const colors=['#7c5cff','#22c55e','#3b82f6','#f59e0b','#ef4444'];
      for(let i=0;i<40;i++){
        const el=document.createElement('i');
        el.style.left=Math.random()*100+'%';
        el.style.bottom='0';
        el.style.setProperty('--x',(Math.random()*120-60)+'px');
        el.style.background=colors[i%colors.length];
        el.style.animationDelay=(Math.random()*0.35)+'s';
        c.appendChild(el);
      }
    }

    const qs=new URLSearchParams(location.search);
    const STEP_KEY=qs.get('step') || "1";
    const SCREEN = (qs.get('screen') || "riddle").toLowerCase();
    const STEP=STEPS[STEP_KEY];

    const stepNameEl=document.querySelector('#stepName');
    const screenTitleEl=document.querySelector('#screenTitle');
    const screenSubtitleEl=document.querySelector('#screenSubtitle');

    const scrRiddle=document.querySelector('#screen-riddle');
    const scrBriefing=document.querySelector('#screen-briefing');
    const scrDest=document.querySelector('#screen-destination');

    const riddleContentEl=document.querySelector('#riddleContent');
    const answerInput=document.querySelector('#answer');
    const submitBtn=document.querySelector('#submitAnswer');
    const attemptsEl=document.querySelector('#attempts');
    const hintBtn=document.querySelector('#hintBtn');
    const msgEl=document.querySelector('#msg');

    const briefingTextEl=document.querySelector('#briefingText');
    const goToDestinationBtn=document.querySelector('#goToDestination');

    const destinationContentEl=document.querySelector('#destinationContent');
    const destHintBtn=document.querySelector('#destHintBtn');
    const destMsg=document.querySelector('#destMsg');

    let attempts=0;

    if(!STEP){
      document.querySelector('#card').innerHTML =
        `<h1>√âtape inconnue</h1><p>Le param√®tre <code>?step=${STEP_KEY}</code> ne correspond √† aucune √©nigme.</p>`;
      throw new Error('STEP not found');
    }

    function renderMedia(container, text, image, audio, textClass){
      container.innerHTML = "";

      if(text){
        const p=document.createElement('p');
        p.className = textClass || "plainText";
        p.textContent = text;
        container.appendChild(p);
      }
      if(image){
        const img=document.createElement('img');
        img.src = image;
        img.alt = "Indice visuel";
        img.className = "mediaImg";
        container.appendChild(img);
      }
      if(audio){
        const a=document.createElement('audio');
        a.controls = true;
        a.src = audio;
        a.className = "mediaAudio";
        container.appendChild(a);
      }
    }

    function showScreenRiddle(){
      scrRiddle.classList.add('active');
      scrBriefing.classList.remove('active');
      scrDest.classList.remove('active');

      stepNameEl.textContent = STEP.label || `√âtape ${STEP_KEY}`;
      screenTitleEl.textContent = STEP.riddleTitle || "√ânigme";
      screenSubtitleEl.textContent = "R√©solvez l'√©nigme pour d√©bloquer une partie du code.";

      renderMedia(
        riddleContentEl,
        STEP.riddleQuestion,
        STEP.riddleImage,
        STEP.riddleAudio,
        "riddle"
      );

      msgEl.textContent="";
      msgEl.className="msg";
      attempts=0;
      attemptsEl.textContent="0 tentative";

      // r√©active champ/bouton si on revient sur l'√©cran
      answerInput.removeAttribute('disabled');
      submitBtn.removeAttribute('disabled');
      answerInput.value = "";
    }

    function showScreenBriefing(){
      scrRiddle.classList.remove('active');
      scrBriefing.classList.add('active');
      scrDest.classList.remove('active');

      stepNameEl.textContent = STEP.label || `√âtape ${STEP_KEY}`;
      screenTitleEl.textContent = STEP.briefingTitle || "Briefing";
      screenSubtitleEl.textContent = "Bravo, voici une partie du code final.";

      briefingTextEl.textContent = STEP.briefingText || "";
      briefingTextEl.style.color = STEP.briefingColor || "var(--fg)";
      briefingTextEl.style.fontSize = STEP.briefingSize || "1.2rem";
      briefingTextEl.style.fontWeight = "600";
    }

    function showScreenDestination(){
      scrRiddle.classList.remove('active');
      scrBriefing.classList.remove('active');
      scrDest.classList.add('active');

      stepNameEl.textContent = STEP.label || `√âtape ${STEP_KEY}`;
      screenTitleEl.textContent = STEP.destinationTitle || "Destination";
      screenSubtitleEl.textContent = "D√©couvrez o√π vous rendre √† pr√©sent.";

      renderMedia(
        destinationContentEl,
        STEP.destinationText,
        STEP.destinationImage,
        STEP.destinationAudio,
        "plainText"
      );

      destMsg.textContent = "";
      destMsg.className = "msg";
    }

    function checkAnswer(){
      const userVal=normalize(answerInput.value);
      const isGood=(STEP.answers||[]).some(ans=>normalize(ans)===userVal);

      attempts++;
      attemptsEl.textContent = `${attempts} ${attempts>1?'tentatives':'tentative'}`;

      if(isGood){
        msgEl.textContent="‚úÖ Bonne r√©ponse !";
        msgEl.className="msg ok";
        answerInput.setAttribute('disabled','');
        submitBtn.setAttribute('disabled','');
        confetti();
        setTimeout(showScreenBriefing, 600);
      }else{
        msgEl.textContent="‚ùå Mauvaise r√©ponse. R√©essayez.";
        msgEl.className="msg err";
        answerInput.focus();
      }
    }

    function showHint(){
      msgEl.textContent = STEP.hint ? ("üí° Indice : " + STEP.hint) : "Aucun indice pour cette √©tape.";
      msgEl.className="msg";
    }

    function showDestHint(){
      destMsg.textContent = STEP.destHint ? ("üí° Indice : " + STEP.destHint) : "Aucun indice pour cette destination.";
      destMsg.className="msg";
    }

    submitBtn.addEventListener('click', checkAnswer);
    answerInput.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){ e.preventDefault(); checkAnswer(); }
    });
    hintBtn.addEventListener('click', showHint);
    goToDestinationBtn.addEventListener('click', showScreenDestination);
    destHintBtn.addEventListener('click', showDestHint);

    if (SCREEN === "destination") {
  showScreenDestination();
} else if (SCREEN === "briefing") {
  showScreenBriefing();
} else {
  showScreenRiddle(); // ‚úÖ valeur par d√©faut
}
  </script>
</body>
</html>
