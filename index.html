<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chasse au tr√©sor</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --bg:#0b1020; --fg:#eef1f7; --muted:#9aa3b2; --card:#121a33;
      --accent:#7c5cff; --ok:#22c55e; --err:#ef4444; --ring:rgba(124,92,255,.3);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f7fb; --fg:#141824; --muted:#606b80; --card:#ffffff; --ring:rgba(124,92,255,.2); }
      body{ background:linear-gradient(180deg,#fbfbff,#eef1ff 25%,#f6f7fb); }
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--fg);
      min-height:100svh;
      display:grid;
      place-items:center;
      padding:24px;
      background:
        radial-gradient(80vw 80vw at 10% 10%, rgba(124,92,255,.08), transparent 40%),
        radial-gradient(70vw 70vw at 90% 0%, rgba(34,197,94,.09), transparent 45%),
        radial-gradient(70vw 70vw at 50% 100%, rgba(59,130,246,.08), transparent 45%),
        var(--bg);
    }
    .shell{width:min(820px,100%)}
    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-radius:20px;
      box-shadow:0 10px 30px rgba(2,6,23,.25);
      padding:28px;
      position:relative;
      overflow:hidden;
      text-align:left;
    }

    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(124,92,255,.12);color:#6b5cff;font-weight:600;font-size:.85rem}
    h1{font-size:clamp(1.4rem,1.1rem+2vw,2.2rem);margin:12px 0 4px;letter-spacing:.3px}
    .subtitle{color:var(--muted);margin:0 0 16px;font-size:1rem;line-height:1.4}
    .riddle{font-size:1.125rem;line-height:1.6;margin:16px 0 18px}

    .inputRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    input[type=text]{flex:1;min-width:200px;padding:14px 14px;border-radius:12px;border:1px solid rgba(124,92,255,.25);outline:0;font-size:1rem;background:transparent;color:var(--fg);box-shadow:0 0 0 0 rgba(0,0,0,0)}
    input[type=text]:focus{box-shadow:0 0 0 6px var(--ring)}
    button.btn{padding:12px 16px;border-radius:12px;border:0;font-weight:600;cursor:pointer;background:linear-gradient(180deg,var(--accent),#5c3bff);color:white;box-shadow:0 6px 16px rgba(92,59,255,.45)}
    button.linkLike{background:transparent;color:var(--accent);box-shadow:none;border:0;padding:6px 8px;font-weight:600;cursor:pointer}
    .rowBetween{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;align-items:center;justify-content:space-between;color:var(--muted);font-size:.95rem}
    .msg{margin-top:14px;font-weight:600}
    .msg.ok{color:var(--ok)}
    .msg.err{color:var(--err)}

    .section{display:none}
    .section.active{display:block}

    .bigText{font-size:1.05rem;line-height:1.6;color:var(--fg);background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;text-align:left}
    .plainText{font-size:1.05rem;line-height:1.6;color:var(--fg);text-align:left}

    .confetti{position:absolute;inset:0;pointer-events:none;}
    .confetti i{position:absolute;width:8px;height:14px;border-radius:2px;opacity:0;animation:pop 1.2s ease-out forwards}
    @keyframes pop{0%{transform:translate(var(--x,0),0) rotate(0);opacity:1}100%{transform:translate(var(--x,0),-160px) rotate(1turn);opacity:0}}
  </style>
</head>
<body>
  <div class="shell">
    <div class="card" id="card">
      <span class="pill">√âtape <span id="stepLabel">?</span></span>
      <h1 id="screenTitle">‚Ä¶</h1>
      <p class="subtitle" id="screenSubtitle">‚Ä¶</p>

      <section id="screen-riddle" class="section">
        <p class="riddle" id="riddleText">Chargement‚Ä¶</p>
        <div class="inputRow">
          <label class="sr-only" for="answer">Votre r√©ponse</label>
          <input id="answer" type="text" autocomplete="off" placeholder="Votre r√©ponse" />
          <button class="btn" id="submitAnswer">Valider</button>
        </div>
        <div class="rowBetween">
          <span id="attempts">0 tentative</span>
          <button class="linkLike" id="hintBtn">Besoin d'un indice ?</button>
        </div>
        <div class="msg" id="msg" aria-live="polite"></div>
      </section>

      <section id="screen-briefing" class="section">
        <div class="bigText" id="briefingText"></div>
        <button class="btn" style="margin-top:20px;width:100%" id="goToDestination">Voir la prochaine √©tape</button>
      </section>

      <section id="screen-destination" class="section">
        <div class="plainText" id="destinationText"></div>
        <button class="linkLike" id="destHintBtn">Besoin d'un indice ?</button>
        <div class="msg" id="destMsg" aria-live="polite"></div>
      </section>

      <div class="confetti" id="confetti" aria-hidden="true"></div>
    </div>
  </div>

  <script>
    const STEPS = {
      "1": {
        riddleTitle: "√ânigme #1",
        riddleQuestion: "Je parle sans bouche et j'entends sans oreilles. Je n'ai pas de corps, mais je prends vie avec le vent. Qui suis-je ?",
        hint: "Pense au son qui revient quand tu cries dans une grotte.",
        answers: ["echo", "l'echo", "l echo", "echo."],
        briefingTitle: "Briefing #1",
        briefingText: "Bravo. Voici votre mission secr√®te : trouvez le mot de passe grav√© sous le banc rouge.",
        briefingColor: "#22c55e",
        briefingSize: "1.6rem",
        destinationTitle: "Destination suivante",
        destinationText: "Rendez-vous sous l'arche en pierre pr√®s de la fontaine. C'est l√†-bas que commence l'√©tape 2.",
        destHint: "Cherchez une arche en pierre o√π le son r√©sonne."
      }
    };

    function normalize(s){return (s||"").toString().trim().toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").replace(/[^a-z0-9'\s.-]/g,"").replace(/\s+/g," ");}
    function confetti(){const c=document.querySelector('#confetti');c.innerHTML='';const colors=['#7c5cff','#22c55e','#3b82f6','#f59e0b','#ef4444'];for(let i=0;i<40;i++){const el=document.createElement('i');el.style.left=Math.random()*100+'%';el.style.bottom='0';el.style.setProperty('--x',(Math.random()*120-60)+'px');el.style.background=colors[i%colors.length];el.style.animationDelay=(Math.random()*0.35)+'s';c.appendChild(el);}}

    const qs=new URLSearchParams(location.search);const STEP_KEY=qs.get('step')||"1";const STEP=STEPS[STEP_KEY];
    const stepLabelEl=document.querySelector('#stepLabel');const screenTitleEl=document.querySelector('#screenTitle');const screenSubtitleEl=document.querySelector('#screenSubtitle');const scrRiddle=document.querySelector('#screen-riddle');const scrBriefing=document.querySelector('#screen-briefing');const scrDest=document.querySelector('#screen-destination');const riddleTextEl=document.querySelector('#riddleText');const answerInput=document.querySelector('#answer');const submitBtn=document.querySelector('#submitAnswer');const attemptsEl=document.querySelector('#attempts');const hintBtn=document.querySelector('#hintBtn');const msgEl=document.querySelector('#msg');const briefingTextEl=document.querySelector('#briefingText');const goToDestinationBtn=document.querySelector('#goToDestination');const destTextEl=document.querySelector('#destinationText');const destHintBtn=document.querySelector('#destHintBtn');const destMsg=document.querySelector('#destMsg');

    let attempts=0;

    if(!STEP){document.querySelector('#card').innerHTML=`<h1>√âtape inconnue</h1><p>Le param√®tre <code>?step=${STEP_KEY}</code> ne correspond √† aucune √©nigme.</p>`;throw new Error('STEP not found');}

    function showScreenRiddle(){scrRiddle.classList.add('active');scrBriefing.classList.remove('active');scrDest.classList.remove('active');stepLabelEl.textContent=STEP_KEY;screenTitleEl.textContent=STEP.riddleTitle;screenSubtitleEl.textContent="R√©solvez l'√©nigme pour d√©bloquer la suite.";riddleTextEl.textContent=STEP.riddleQuestion;msgEl.textContent="";msgEl.className="msg";attempts=0;attemptsEl.textContent="0 tentative";}
    function showScreenBriefing(){scrRiddle.classList.remove('active');scrBriefing.classList.add('active');scrDest.classList.remove('active');screenTitleEl.textContent=STEP.briefingTitle;screenSubtitleEl.textContent="Lisez bien ces instructions.";briefingTextEl.textContent=STEP.briefingText;briefingTextEl.style.color=STEP.briefingColor||"var(--fg)";briefingTextEl.style.fontSize=STEP.briefingSize||"1.2rem";briefingTextEl.style.fontWeight="600";}
    function showScreenDestination(){scrRiddle.classList.remove('active');scrBriefing.classList.remove('active');scrDest.classList.add('active');screenTitleEl.textContent=STEP.destinationTitle;screenSubtitleEl.textContent="Voici o√π aller maintenant.";destTextEl.textContent=STEP.destinationText;}

    function checkAnswer(){const userVal=normalize(answerInput.value);const isGood=(STEP.answers||[]).some(ans=>normalize(ans)===userVal);attempts++;attemptsEl.textContent=`${attempts} ${attempts>1?'tentatives':'tentative'}`;if(isGood){msgEl.textContent="‚úÖ Bonne r√©ponse !";msgEl.className="msg ok";answerInput.setAttribute('disabled','');submitBtn.setAttribute('disabled','');confetti();setTimeout(()=>{showScreenBriefing();},600);}else{msgEl.textContent="‚ùå Mauvaise r√©ponse. R√©essayez.";msgEl.className="msg err";answerInput.focus();}}
    function showHint(){if(STEP.hint){msgEl.textContent="üí° Indice : "+STEP.hint;msgEl.className="msg";}else{msgEl.textContent="Aucun indice pour cette √©tape.";msgEl.className="msg";}}
    function showDestHint(){if(STEP.destHint){destMsg.textContent="üí° Indice : "+STEP.destHint;destMsg.className="msg";}else{destMsg.textContent="Aucun indice pour cette destination.";destMsg.className="msg";}}
    function goDestination(){showScreenDestination();}

    submitBtn.addEventListener('click',checkAnswer);answerInput.addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();checkAnswer();}});hintBtn.addEventListener('click',showHint);goToDestinationBtn.addEventListener('click',goDestination);destHintBtn.addEventListener('click',showDestHint);

    showScreenRiddle();
  </script>
</body>
</html>
